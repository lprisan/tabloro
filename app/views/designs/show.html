{% extends '../layouts/default.html' %}

{% block main %}
  <h1>
    {{ title }}
  </h1>
{% endblock %}

{% block content %}
  <section class="container">
    <div class="spacer"></div>

    <div class="col-md-8">
      <div class="panel panel-default">
        <div class="panel-heading">
          <h4>
            <i class="fa fa-sitemap pull-left muted"></i>
            {{setup.title | title}}
          </h4>
        </div>
        <div class="panel-body">
          {% if (setup.description) %}
            <hr>
            <h4>{{ __('Description')}}</h4>
            <pre>{{setup.description}}</pre>
          {% endif %}

          <div class="design-preview text-center" id="designPreview">
            <!--canvas id="previewcanvas" width="1412" height="875" style="border:1px solid #d3d3d3;"-->
            <canvas id="previewcanvas" width="500" height="310" style="border:1px solid #d3d3d3;">
              Your browser does not support the HTML5 canvas tag.
            </canvas>
          </div>
          <div id="invisibleimgs" style="display:none;"></div>

          <!--Hover previews of different versions-->
          <!--div class="hover-preview text-center" id="hoverPreview" style="display:none;">
            <canvas id="hoverPreviewcanvas" width="500" height="310" style="border:1px solid #d3d3d3;">
              Your browser does not support the HTML5 canvas tag.
            </canvas>
          </div-->

          <script type="text/javascript">
              var pieces = {% if (setupPieces) %}{{JSON.stringify(setupPieces)}}{% else %}[]{% endif %};
              console.log("Pieces (UNSORTED!): "+JSON.stringify(pieces));

              var latestversion = {% if (versions && versions.length>0) %}{{JSON.stringify(versions[0])}}{% else %}{}{% endif %};
              var allversions = {% if (versions && versions.length>0) %}{{JSON.stringify(versions)}}{% else %}[]{% endif %};
              console.log("Latest design version (out of {% if (versions && versions.length) %}{{versions.length}}{% endif %}): "+JSON.stringify(latestversion));
              var MSG_FBSECTION1 = "{{ __('Position errors')}}";
          </script>
          <script src='/js/previewdesign.js'></script>

        </div>


        <div class="panel-footer">
          <div class="btn-group btn-group-justified">
            {% if isOwner %}
            <a class="btn btn-danger btn-lg" href="/designs/{{setup._id.toString()}}/capture">
              {{ __('Capture')}} &nbsp;
              <i class="fa fa-camera"></i>
            </a>
                <a class="btn btn-success btn-lg" href="/designs/{{setup._id.toString()}}/play4TsLatest">
                  {{ __('Play (virtually)')}} &nbsp;
                  <i class="fa fa-play"></i>
                </a>
            {% endif %}
            <a class="btn btn-info btn-lg" href="#" onclick="askDesignCopy('/designs/{{setup._id.toString()}}/copy');">
              {{ __('Create copy')}} &nbsp;
              <i class="fa fa-files-o"></i>
            </a>
          </div>
        </div>
      </div>
    </div>


    <div class="col-md-4">
      <ul class="list-group">
        {% if (setup.isPrivate) %}
          <li class="list-group-item list-group-item-warning">{{ __('This Design is Private (but you can share it with others by copying/pasting the address you see now in your browser navigation bar)')}}</li>
        {% else %}
          <li class="list-group-item list-group-item-success">{{ __('This Design is Public')}}</li>
        {% endif %}


        <li class="list-group-item list-group-item-default">
          {{ __('Created by')}}
          <strong class="pull-right">{{setup.user.username}}</strong>
        </li>



        <li class="list-group-item list-group-item-default">Created {{ setup.createdAt.toISOString()|date('M d,  h:i a') }}</li>
        {% if (setup.tags) %}
          <li class="list-group-item meta">
            <p>
            {{ __('Tags')}}: &nbsp;
            {% for tag in setup.tags.split(',') %}
              <i class="muted fa fa-tag"></i>&nbsp;
              <a href="{{ '/tags/' + tag }}" class="tag">{{ tag }}</a>
              &nbsp;&nbsp;
            {% endfor %}
            </p>
          </li>
        {% endif %}
        {% if isOwner || isAdmin %}
<!--           <li class="list-group-item list-group-item-warning">
            <a href="{{ '/setups/' + setup.title + '/edit' }}" title="edit" class="btn btn-warning">
              Edit Game Setup
            </a>
          </li> -->
          <li class="list-group-item list-group-item-danger">
            <form action="{{ '/designs/' + setup._id }}" method="post" onsubmit="return confirm('{{ __('Are you sure?')}}')">
              <input type="hidden" name="_csrf" value="{{ csrf_token }}">
              <input type="hidden" name="_method" value="DELETE">
              <button class="btn btn-danger" type="submit">{{ __('Delete Design')}}</button>
            </form>
          </li>
        {% endif %}
      </ul>
    </div>


  </section>

  <div class="spacer"></div>

  <section class="bg-warning about">
    <div class="container">
      <ul class="list-group">
          <li class="list-group-item list-group-item-warning">{{ __('Design versions')}} ({{ __('Click to play virtually over that version')}})</li>
          {% if (versions && versions.length>0) %}
              {% for version in versions %}
              <li class="list-group-item meta">
                <i class="muted fa fa-code-fork"></i>&nbsp;
                <a class="versionlink" href="{{ '/tables/' + version.title + '/play4Ts' }}" rel="{{ version._id.toString() }}">{{ version._id.toString() }}</a>
                &nbsp;&nbsp;
                {{ version.createdAt.toISOString() }}
                &nbsp;&nbsp;
                -- {% if (version.description) %}{{version.description}}{% endif %}
                &nbsp;&nbsp;
                --
                <a href="#" onclick="askDesignDescription('{% if (version.description) %}{{version.description}}{% endif %}','{{ '/tables/' + version._id + '/updateDesc' }}');">{{ __('Edit description')}} <i class="muted fa fa-pencil-square-o"></i></a>

              </li>
              {% endfor %}
          {% else %}
          <li class="list-group-item meta">
            <span class="">{{ __('There are no recorded versions of this design yet')}}</span>
          </li>
          {% endif %}


    </div>
  </section>



  <div class="spacer"></div>

  <section class="bg-primary about">
    <div class="container">

      <a href="/designs" class="btn btn-info">
        <i class="fa fa-backward"></i>
        {{ __('Back to designs')}}
      </a>
    </div>
  </section>
{% endblock %}
